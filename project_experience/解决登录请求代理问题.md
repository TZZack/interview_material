# 解决登录请求代理问题

## 背景

### 登录

加了一个登录服务器，这个登录服务器有点特殊

* 必须要通过form表单去submit提交请求
* 登录请求需要做两次302重定向，即登录过程客户端需要发3次请求，最后一次请求才去set-cookie，然后重定向到首页

问题

302重定向，脚手架是无法控制的，因为这是浏览器行为，这就导致登录请求没办法再像之前那样做代理转发了，也就是没有办法去本地调试了

暂时解决：

一开始遇到这个问题后，后端那边给了个临时方案，服务器可以开启mock认证，也就是不需要登录了，这样有个局限性，每次都需要先开启mock认证，很麻烦

### 脚手架

最终解决，我们脚手架有个node.js代理服务，用的是express框架，因为express是有个中间件的，可以对请求进行拦截和转发，然后就注册了个中间件去拦截登录请求，去修改响应头的location，把location的域名改为localhost，然后客户端在做302重定向时请求就能被脚手架代理到，然后最终的set-cookie也是设置给到本地调试的域名，最终也顺利跳转首页